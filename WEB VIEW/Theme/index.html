<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="Dashboard">
        <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

        <title>Restaurante La Nourriture</title>
        
        <link href="assets/css/bootstrap.css" rel="stylesheet">
        <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet"/>
        <link href="assets/css/zabuto_calendar.css" rel="stylesheet">
        <link href="assets/js/gritter/css/jquery.gritter.css" rel="stylesheet">
        <link href="assets/lineicons/style.css" rel="stylesheet">
        <link href="css/app.css" rel="stylesheet">
        <link href="bootstrap.css" rel="stylesheet" id="bootstrap-css">
        <link href="assets/css/style.css" rel="stylesheet">
        <link href="assets/css/style-responsive.css" rel="stylesheet">

        <link href="fontAwesome.css" rel="stylesheet"> 

        
        <link rel="stylesheet" type="text/css" href="slick.css"/>
        <link rel="stylesheet" type="text/css" href="slick-theme.css"/>
        <script src="scrollreveal.js"></script>
        <script src="bootstrap.js"></script>
        <script src="jquery.min.js"></script>
        <script src="assets/js/saudacao.js"></script>

        <script src="assets/js/chart-master/Chart.js"></script>
        <script src="html5shiv.js"></script>
        <script src="respond.js"></script>
    </head>

    <body onload="pegarDados()">
        <section id="container">
        <header class="header black-bg">
            <div class="sidebar-toggle-box">
                <div class="fa fa-bars tooltips" data-placement="right" ></div>
            </div>
            <a href="index.html"class="logo"><b>La Nourriture</b></a>
                <div class="nav notify-row" id="top_menu">
                    <ul class="nav top-menu">                   
                    </ul>
                </div>
        </header>
        <aside>
            <div id="sidebar"  class="nav-collapse ">
                <ul class="sidebar-menu" id="nav-accordion">
                <p class="centered">
                    <a href="profile.html">
                        <img src="assets/img/ui-sam.jpg" class="img-circle" width="150">
                    </a>
                </p>
                <li class="sub-menu">
                    <a href="index.html" >
                        <i class="fas fa-utensils"></i>
                        <span>Cardápio</span>
                    </a>
                </li>
                <li class="sub-menu">
                    <a href="pedidos.html" >
                        <i class="fas fa-shopping-basket"></i>
                        <span>Pedido</span>
                    </a>
                </li>
                </ul>
            </div>
        </aside>
        <section id="main-content">
            <section class="wrapper">
                <div class="row">
                    <div class="col-lg-12 main-chart">
                        <section id="main-menu" class="menu-cart scroll-reveal">
                            <div class="container">
                                <h1 class="header-txt">CARDÁPIO</h1>
                                <div class="divider">
                                    <?xml version="1.0" encoding="utf-8"?>
                                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1930 255.5" style="enable-background:new 0 0 1930 255.5;" xml:space="preserve">
                                        <style type="text/css">
                                            .st0{fill:none;stroke:#3c3c3c;stroke-width:10;stroke-linecap:square;stroke-miterlimit:10;}
                                        </style>
                                        <polyline class="st0" points="1224,171.8 1181.3,171.8 1139.2,129.6 1065,203.9 970.5,110.4 876,203.6 801.8,129.4 759.7,171.5 
                                            717,171.5 "/>
                                        <polyline class="st0" points="5,131.5 757.3,131.5 801.8,176.1 885.9,91.9 868.3,74.2 831.5,111 870.4,149.9 970.2,50.2 1070,149.9 
                                            1108.8,111 1072.1,74.2 1054.4,91.9 1138.5,176.1 1183.1,131.5 1925,131.5 "/>
                                        <rect x="921.9" y="26.7" transform="matrix(0.7071 -0.7071 0.7071 0.7071 231.426 707.2043)" class="st0" width="95" height="95"/>
                                        <rect x="921.9" y="99.7" transform="matrix(0.7071 -0.7071 0.7071 0.7071 179.8072 728.5855)" class="st0" width="95" height="95"/>
                                        <rect x="940.3" y="178.1" transform="matrix(0.7071 -0.7071 0.7071 0.7071 137.3893 746.1556)" class="st0" width="58.2" height="58.2"/>
                                    </svg>
                                </div>
                                <div></div>
                                <ul class="menu-navigation" data-tabs data-match-height="true" id="example-tabs">
                                    <li class="tabs-title is-active">
                                        <a class="m-anim" data-tabs-target="panel1" href="#panel1" data-text="Main Dishes">Pratos Principais</a>
                                    </li>
                                </ul>

                                <div class="tabs-content" data-tabs-content="example-tabs">
                                    <div class="tabs-panel is-active" id="panel1">
                                        <div class="menu-content">
                                            <div class="menu-section">
                                                <table>
                                                    <tr>
                                                        <td><span>SMOKED RICOTTA TERRINE</span></td>
                                                        <td><span>$12</span></td>
                                                        
                                                    </tr>
                                                    <tr>
                                                        <td>ricotta, shallots, cheddar, capers</td>
                                                    </tr> 
                                                </table>
                                                <div class="text-right">
                                                 <button type="button" class="btn btn-default btn-sm"> 
                                                    <span class="glyphicon glyphicon-shopping-cart"></span> Adicionar
                                                </button>
                                                    </div>
                                            </div>
                                            <div class="menu-section">
                                                <table>
                                                    <tr>
                                                        <td><span>SAMPHIRE FRITTERS WITH FENNEL CEVICHE </span></td>
                                                        <td><span>$19</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>fresh samphire, plain flour, cornflower, eggs, fennel</td>
                                                    </tr>
                                                </table>
                                                <div class="text-right">
                                                 <button type="button" class="btn btn-default btn-sm"> 
                                                    <span class="glyphicon glyphicon-shopping-cart"></span> Adicionar
                                                </button>
                                                    </div>
                                            </div>

                                <div id="marginProducts">
                                    <div class="tabs-content" data-tabs-content="example-tabs">
                                        <div class="tabs-panel is-active" id="panel1">

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section>
                            <div class="row">
                                    <div class="col-lg-3">
                                    </div>
                                <div class="col-lg-3">
                                    <label>garçom</label>
                                    <select id="garcom" style="font-size: 10px;"></select>
                                </div>
                                <div class="col-lg-3">
                                    <label>mesa</label><br>
                                    <select id="mesa" style="font-size: 10px;"></select>
                                </div>
                            </div>
                        </section>
                         <div class="modal-footer centered">
                            <button type="button" class="btn btn-round btn-success" onclick="fazerPedido()">Fazer pedido</button>
                        </div>
                    </div>
                </div>
            </section>
            <br><br>
            <footer class="site-footer">
                <div class="text-center">
                    2018 - For Restaurant 
                    <a href="index.html#" class="go-top">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>
            </footer>
        </section>
        <script src="jquery.js"></script>
        <script src="what-input.js"></script>
        <script src="foundation.js"></script>
        <script src="js/app.js"></script>
        <script type="text/javascript" src="slick.js"></script>
        <script src="scrollreveal.min.js"></script>

        <script type="text/javascript">
            $('.slider').slick({
                infinite: true,
                autoplay: true,
                autoplaySpeed: 3500,
                arrows: false,
                fade: true,
                cssEase: 'linear'
            });

        </script>

        <script>
            $(window).on('load', function() {
                $("#preloader").fadeOut();
            });
        </script>
        <script src="assets/js/jquery.js"></script>
        <script src="assets/js/jquery-1.8.3.min.js"></script>
        <script src="assets/js/bootstrap.min.js"></script>
        <script class="include" type="text/javascript" src="assets/js/jquery.dcjqaccordion.2.7.js"></script>
        <script src="assets/js/jquery.scrollTo.min.js"></script>
        <script src="assets/js/jquery.nicescroll.js" type="text/javascript"></script>
        <script src="assets/js/jquery.sparkline.js"></script>
        <script src="assets/js/common-scripts.js"></script>
        <script type="text/javascript" src="assets/js/gritter/js/jquery.gritter.js"></script>
        <script type="text/javascript" src="assets/js/gritter-conf.js"></script>
        <script src="assets/js/sparkline-chart.js"></script>    
        <script src="assets/js/zabuto_calendar.js"></script>	
        <script type="text/javascript">
        $(document)
            .ready(function () {
                var unique_id = $.gritter.add({
                    title: 'Bem-vindo(a) ao La Nourriture',
                    text: 'Para solicitar sua refeição, basta ir até a opção "Cardápio". Para acompanhar seu pedido, basta ir até a opção "Pedido".',
                    image: 'assets/img/ui-sam.jpg',
                    sticky: true,
                    time: '',
                    class_name: 'my-sticky-class'
                });
                return false;
            });
        </script>

        <script type="application/javascript">
            $(document)
            .ready(function () {
                $("#date-popover").popover({html: true, trigger: "manual"});
                $("#date-popover").hide();
                $("#date-popover")
                .click(function (e) {
                    $(this).hide();
                });

                $("#my-calendar")
                .zabuto_calendar({
                    action: function () {
                        return myDateFunction(this.id, false);
                    },
                    action_nav: function () {
                        return myNavFunction(this.id);
                    },
                    ajax: {
                        url: "show_data.php?action=1",
                        modal: true
                    },
                    legend: [
                        {type: "text", label: "Special event", badge: "00"},
                        {type: "block", label: "Regular event", }
                    ]
                });
            });
            function myNavFunction(id) {
                $("#date-popover").hide();
                var nav = $("#" + id).data("navigation");
                var to = $("#" + id).data("to");
                console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
            }
        </script>

        <script>       
            const pegarDados = () =>{
                let Request1 = new XMLHttpRequest()
                let Request2 = new XMLHttpRequest()
                let Request3 = new XMLHttpRequest()

                Request2.open("GET", "http://localhost:8000/tables", true)
                Request2.setRequestHeader("Content-Type", "application/json");
                Request2.send()
                Request2.onreadystatechange = function() {
                    if (Request2.readyState == 4 && Request2.status == 200) {
                        var data = JSON.parse(Request2.responseText);
                        const mesaID = document.getElementById("mesa")
                        let mesa = `<option value="" selected>Selecione</option>`

                        for(let i = 0 ; i < data.length; i++){
                            mesa += `<option value="${data[i].id_mesa}">${data[i].nome}</option>`
                        }

                        mesaID.innerHTML = mesa
                    }
                }

                Request3.open("GET", "http://localhost:8000/garcom", true)
                Request3.setRequestHeader("Content-Type", "application/json");
                Request3.send()
                Request3.onreadystatechange = function() {
                    if (Request3.readyState == 4 && Request3.status == 200) {
                        var data = JSON.parse(Request3.responseText);
                        const garcomID = document.getElementById("garcom")
                        let garcom = `<option value="" selected>Selecione</option>`

                        for(let i = 0 ; i < data.length; i++){
                            garcom += `<option value="${data[i].id_garcon}">${data[i].nome}</option>`
                        }

                        garcomID.innerHTML = garcom
                    }
                }

                Request1.open("GET", "http://localhost:8000/product", true)
                Request1.setRequestHeader("Content-Type", "application/json");
                Request1.send()
                Request1.onreadystatechange = function() {
                    if (Request1.readyState == 4 && Request1.status == 200) {
                        var data = JSON.parse(Request1.responseText);
                        console.log(data)
                        const produtosID = document.getElementById("panel1")
                        const productsDiv = document.getElementById("marginProducts")
                        let produtos = `<div class="menu-content">`
                        for(let i = 0 ; i < data.length ; i++){
                            if((i%2 == 0)){
                                produtos += `
                                    <div class="menu-section">
                                        <table>
                                            <tr>
                                                <td><span>${data[i].nome}</span></td>
                                                <td><span>$${data[i].valor}</span></td>
                                                <div class="center">
                                            </tr>
                                            <tr>
                                                <td>${data[i].descricao}</td>
                                            </tr> 
                                        </table>
                                        <div class="text-right">
                                            <span></span>
                                            <button type="button" class="btn btn-default btn-sm" onclick="addComidinha(${data[i].id_produto})"> 
                                                <span class="glyphicon glyphicon-shopping-cart"></span> Adicionar
                                            </button>
                                        </div>
                                    </div>
                            `   
                            }
                        }

                        for(let j = 0 ; j < data.length; j++){
                            if (j%2 == 1){
                                produtos += `
                                <div class="menu-section">
                                        <table>
                                            <tr>
                                                <td><span>${data[j].nome}</span></td>
                                                <td><span>$${data[j].valor}</span></td>
                                                <div class="center">
                                            </tr>
                                            <tr>
                                                <td>${data[j].descricao}</td>
                                            </tr> 
                                        </table>
                                        <div class="text-right">
                                            <span></span>
                                            <button type="button" class="btn btn-default btn-sm" onclick="addComidinha(${data[j].id_produto})"> 
                                                <span class="glyphicon glyphicon-shopping-cart"></span> Adicionar
                                            </button>
                                        </div>
                                    </div>
                            `   
                            }
                        }
                        produtos += `</div>`

                        setTimeout(() => {
                            console
                            productsDiv.style = `margin-bottom: ${data.length * 40}px`
                            produtosID.innerHTML = produtos
                        }, 500);
                    }
                }
            }

            let productKeys = {}

            const addComidinha = (idProduto)=>{
                if(productKeys[idProduto]){
                    productKeys[idProduto].qunatidade++
                }else{
                    productKeys[idProduto] = {
                        id_produto: idProduto,
                        qunatidade: 1
                    }
                }
            }

            const fazerPedido = () =>{
                let Request = new XMLHttpRequest()
                const idGarcon = document.getElementById("garcom").value
                const idMesa = document.getElementById("mesa").value
                const produtos = document.getElementsByName("produtos")

                let request = {
                    "id_garcon": idGarcon,
                    "id_mesa": idMesa,
                    "products": []
                }	

                const keys = Object.keys(productKeys)
                for(let i = 0; i < keys.length; i++){
                    request.products.push(productKeys[keys[i]])
                }

                Request.open("POST", "http://localhost:8000/order", true)
                Request.setRequestHeader("Content-Type", "application/json");
                Request.send(JSON.stringify(request))
                Request.onreadystatechange = function() {
                    if (Request.readyState == 4 && Request.status == 200) {
                        var data = JSON.parse(Request.responseText);
                        if(!data.message){
                            alert("pedido realizado com sucesso")
                        }
                    }
                }
            }
        </script>
    </body>
</html>
